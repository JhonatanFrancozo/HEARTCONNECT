<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartConnect | QUIZ</title>
    <link rel="stylesheet" href="../css/quiz.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
    <body onload="validarSessao()">
    <div class="janela">
    
        <!-- header -->
        <nav class="nav">
            <img src="../assets/img/logo3.png" alt="Logo do site" class="logo">
            <ul class="nav-links">
                <li><a href='./quiz.html'>Quiz</a></li>
                <li><a href='./sobre.html'>Sobre</a></li>
                <li><a href='./mural.html'>Chat</a></li>
            </ul>
            <div class="logar">
                <div class="hello">
                    <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                </div>
            </div>
        </nav>
        <h2 id="txtprincipal">QUIZ HEARTSTOPPER</h2>
        <!-- TERMINOheader -->
        <div id="s1">
        <div id="meio">
            
            <br><br><br>
            <p>Quiz de conhecimentos gerais sobre</p>
            <p>Heartstopper!</p>
            <br>
            <p>A cada pergunta que você acertar</p>
            <p>será computado +5 pontos no seu score.</p>
            <p>No final do quiz haverá uma dashboard com</p>
            <p>métricas de seus resultados e rank global!</p>
            <br>
            <br>
            <div id="botoes">
            <button onclick="passar()">Iniciar</button>
            <button onclick="dash()">Dashboard</button>
        </div>
        </div>
    </div>

    <div id="s2">
        <div id="meio">
            <br><br><br>
            <p>A série é baseada em uma saga de livros britânicos. Qual o nome da autora?</p>
            <br><br>
        <div id="perguntas">
            <button id="p1" onclick="b1()">Alice Osman</button>
            <button id="p2" onclick="b2()">Jenny Han</button>
            <button id="p3" onclick="b3()">Coolleen</button>
            <button id="p4" onclick="b4()">Tillie Cole</button>
        </div>

            <br>
            <br>
            
        </div>
        
    </div>



    <div id="s3">
        <div id="meio">
            <br><br><br>
            <p>Qual famosa atriz interpreta a mãe do personagem Nick?</p>
            <br><br>
        <div id="perguntas">
            <button id="p5" onclick="c1()">Nicole Kidman</button>
            <button id="p6" onclick="c2()">Olivia Colman</button>
            <button id="p7" onclick="c3()">Penelope Cruz</button>
            <button id="p8" onclick="c4()">Meryl Streep</button>
        </div>

            <br>
            <br>
            
        </div>
    </div>

    <div id="s4">
        <div id="meio">
            <br><br><br>
            <p>
                Qual o esporte principal da série?</p>
            <br><br>
        <div id="perguntas">
            <button id="p9" onclick="d1()">Boliche</button>
            <button id="p10" onclick="d2()">Futebol</button>
            <button id="p11" onclick="d3()">Basquete</button>
            <button id="p12" onclick="d4()">Rugby</button>
        </div>

            <br>
            <br>
            
        </div>
    </div>

    <div id="s5">
        <div id="meio">
            <br><br><br>
            <p>Qual matéria o professor Farouk dá na escola e é um dos poucos que protege Charlie do bullying?</p>
            <br><br>
        <div id="perguntas">
            <button id="p13" onclick="e1()">Artes</button>
            <button id="p14" onclick="e2()">História</button>
            <button id="p15" onclick="e3()">Matemática</button>
            <button id="p16" onclick="e4()">Biologia</button>
        </div>

            <br>
            <br>
            
        </div>
    </div>

    <div id="s6">
        <div id="meio">
            <br><br><br>
            <p>Charlie sempre desejou alguém:</p>
            <br><br>
        <div id="perguntas">
            <button id="p17" onclick="f1()">baixo</button>
            <button id="p18" onclick="f2()">inteligente</button>
            <button id="p19" onclick="f3()">alto</button>
            <button id="p20" onclick="f4()">magro</button>
        </div>

            <br>
            <br>
            
        </div>
    </div>

    <div id="s7">
        <div id="meio">
            <br><br><br>
            <p>Qual instrumento Charlie toca na banda da escola?</p>
            <br><br>
        <div id="perguntas">
            <button id="p21" onclick="g1()">Gaita</button>
            <button id="p22" onclick="g2()">Guitarra</button>
            <button id="p23" onclick="g3()">Violão</button>
            <button id="p24" onclick="g4()">Bateria</button>
        </div>

            <br>
            <br>
            
        </div>
    </div>

    <div id="s8">
        <div id="meio">
            <br><br><br>
            <p>Qual a relação entre Darcy e Tara??</p>
            <br><br>
        <div id="perguntas">
            <button id="p25" onclick="h1()">Namoradas</button>
            <button id="p26" onclick="h2()">Primas</button>
            <button id="p27" onclick="h3()">Irmãs</button>
            <button id="p28" onclick="h4()">Amigas</button>
        </div>

            <br>
            <br>
            
        </div>
    </div>
    


    <div id="s9">
        <div id="meio">
            <br><br>
            <p>DASHBOARD DO QUIZ!</p>
            <div id="msg"></div>
            <br><br>
    
            <div id="content-container">
                <div id="message-container">
                    <p>Rank de pontuação</p>
                    <canvas id="myChart2"></canvas>
                </div>
                <div id="chart-container">
                    <p>Seus erros e acertos</p>
                    <canvas id="myChart"></canvas>
                </div>
            </div>
    
            <br>
            <br>
        </div>
    </div>

    <script>

        const data = {
            labels: ['Erros', 'Acertos'],
            datasets: [{
                label: 'Erros e Acertos',
                data: [0, 0],
                backgroundColor: [
                    'rgb(255, 99, 132)',
                    'rgb(54, 162, 235)'
                ],
                hoverOffset: 4
            }]
        };

        const config = {
            type: 'pie',
            data: data,
        };

        const myChart = new Chart(
            document.getElementById('myChart'),
            config
        );
    </script>





<script>
    const labels2 = ['January', 'February', 'March', 'April', 'May', 'June'];
    const data2 = {
        labels: labels2,
        datasets: [{
            label: 'Pontuação',
            data: [65, 59, 80, 81, 56, 55, 40],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 205, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(201, 203, 207, 0.2)'
            ],
            borderColor: [
                'rgb(255, 99, 132)',
                'rgb(255, 159, 64)',
                'rgb(255, 205, 86)',
                'rgb(75, 192, 192)',
                'rgb(54, 162, 235)',
                'rgb(153, 102, 255)',
                'rgb(201, 203, 207)'
            ],
            borderWidth: 1
        }]
    };

    const config2 = {
        type: 'bar',
        data: data2,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        },
    };

    const myChart2 = new Chart(
        document.getElementById('myChart2'),
        config2
    );
</script>

    

<div id="loading" style="display: none;">
    <img src="../assets/img/gif.png!sw800" alt="Loading...">
</div>



</div>
    <script>
        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    </script>
    </body>
</html>
<script>
    var pts = 0;
    var acerto = [];
    var erro = 0;
    s1.style.display="block";
    s2.style.display="none";
    s3.style.display="none";
    s4.style.display="none";
    s5.style.display="none";
    s6.style.display="none";
    s7.style.display="none";
    s8.style.display="none";
    s9.style.display="none";

    function showLoading() {
        document.getElementById('loading').style.display = 'block';
    }

    function hideLoading() {
        document.getElementById('loading').style.display = 'none';
    }

    function setTimeoutWithLoading(func, delay) {
        showLoading();
        setTimeout(function() {
            hideLoading();
            func();
        }, delay);
    }


    function dash() {
        s1.style.display="none";
        s9.style.display="block";
        rankgeral();
        puxarerroacerto()
    }

    function passar() {
        s1.style.display="none";
        s2.style.display="block";
    }

    function disableButtons() {
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => button.disabled = true);
}

// Função para ativar todos os botões
function enableButtons() {
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => button.disabled = false);
}

    // primeira

function b1() {
    disableButtons();
    console.log('Botão com id p1 foi clicado.');
    pts = pts + 5;
    acerto.push(1);
    console.log(pts);
    p1.style.backgroundColor = 'green';
    setTimeoutWithLoading(function() {
            s2.style.display = "none";
            s3.style.display = "block";
            enableButtons();
        }, 2000);
}

function b2() {
    disableButtons();
    console.log('Botão com id p2 foi clicado.');
    p2.style.backgroundColor = 'red';
    erro = erro + 1;
    setTimeoutWithLoading(function() {
            s2.style.display = "none";
            s3.style.display = "block";
            enableButtons();
        }, 2000);
}

function b3() {
    disableButtons();
    console.log('Botão com id p3 foi clicado.');
    p3.style.backgroundColor = 'red';
    erro = erro + 1;
    setTimeoutWithLoading(function() {
            s2.style.display = "none";
            s3.style.display = "block";
            enableButtons();
        }, 2000);
}

function b4() {
    disableButtons();
    console.log('Botão com id p4 foi clicado.');
    p4.style.backgroundColor = 'red';
    erro = erro + 1;
    setTimeoutWithLoading(function() {
            s2.style.display = "none";
            s3.style.display = "block";
            enableButtons();
        }, 2000);
}


    // segunda

    function c1() {
        disableButtons();
        if (p5.onclick) {
            console.log('Botão com id p5 foi clicado.');
            p5.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s3.style.display = "none";
            s4.style.display = "block";
            enableButtons();
        }, 2000);
        } 
    }
    function c2() {
        disableButtons();
        if (p6.onclick) {
            console.log('Botão com id p6 foi clicado.');
            p6.style.backgroundColor = 'green';
            acerto.push(1);
            pts = pts + 5;
            console.log(pts);
            setTimeoutWithLoading(function() {
            s3.style.display = "none";
            s4.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function c3() {
        disableButtons();
        if (p7.onclick) {
            console.log('Botão com id p7 foi clicado.');
            p7.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s3.style.display = "none";
            s4.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function c4() {
        disableButtons();
        if (p8.onclick) {
            console.log('Botão com id p8 foi clicado.');
            p8.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s3.style.display = "none";
            s4.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }

    // terceira

    function d1() {
        disableButtons();
        if (p9.onclick) {
            console.log('Botão com id p9 foi clicado.');
            p9.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s4.style.display = "none";
            s5.style.display = "block";
            enableButtons();
        }, 2000);
        } 
    }
    function d2() {
        disableButtons();
        if (p10.onclick) {
            console.log('Botão com id p10 foi clicado.');
            p10.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s4.style.display = "none";
            s5.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function d3() {
        disableButtons();
        if (p11.onclick) {
            console.log('Botão com id p11 foi clicado.');
            p11.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s4.style.display = "none";
            s5.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function d4() {
        disableButtons();
        if (p12.onclick) {
            console.log('Botão com id p12 foi clicado.');
            p12.style.backgroundColor = 'green';
            acerto.push(1);
            pts = pts + 5;
            console.log(pts);
            setTimeoutWithLoading(function() {
            s4.style.display = "none";
            s5.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
          
    // quarta

    function e1() {
        disableButtons();
        if (p13.onclick) {
            console.log('Botão com id p13 foi clicado.');
            p13.style.backgroundColor = 'green';
            acerto.push(1);
            pts = pts + 5;
            console.log(pts);
            setTimeoutWithLoading(function() {
            s5.style.display = "none";
            s6.style.display = "block";
            enableButtons();
        }, 2000);
        } 
    }
    function e2() {
        disableButtons();
        if (p14.onclick) {
            console.log('Botão com id p14 foi clicado.');
            p14.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s5.style.display = "none";
            s6.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function e3() {
        disableButtons();
        if (p15.onclick) {
            console.log('Botão com id p15 foi clicado.');
            p15.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s5.style.display = "none";
            s6.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function e4() {
        disableButtons();
        if (p16.onclick) {
            console.log('Botão com id p16 foi clicado.');
            p16.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s5.style.display = "none";
            s6.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }

    // quinta

    function f1() {
        disableButtons();
        if (p17.onclick) {
            console.log('Botão com id p17 foi clicado.');
            p17.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s6.style.display = "none";
            s7.style.display = "block";
            enableButtons();
        }, 2000);
        } 
    }
    function f2() {
        disableButtons();
        if (p18.onclick) {
            console.log('Botão com id p18 foi clicado.');
            p18.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s6.style.display = "none";
            s7.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function f3() {
        disableButtons();
        if (p19.onclick) {
            console.log('Botão com id p19 foi clicado.');
            p19.style.backgroundColor = 'green';
            acerto.push(1);
            pts = pts + 5;
            console.log(pts);
            setTimeoutWithLoading(function() {
            s6.style.display = "none";
            s7.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function f4() {
        disableButtons();
        if (p20.onclick) {
            console.log('Botão com id p20 foi clicado.');
            p20.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s6.style.display = "none";
            s7.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    
    // sexta

    function g1() {
        disableButtons();
        if (p21.onclick) {
            console.log('Botão com id p21 foi clicado.');
            p21.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s7.style.display = "none";
            s8.style.display = "block";
            enableButtons();
        }, 2000);
        } 
    }
    function g2() {
        disableButtons();
        if (p22.onclick) {
            console.log('Botão com id p22 foi clicado.');
            p22.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s7.style.display = "none";
            s8.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function g3() {
        disableButtons();
        if (p23.onclick) {
            console.log('Botão com id p23 foi clicado.');
            p23.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s7.style.display = "none";
            s8.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }
    function g4() {
        disableButtons();
        if (p24.onclick) {
            console.log('Botão com id p24 foi clicado.');
            p24.style.backgroundColor = 'green';
            acerto.push(1);
            pts = pts + 5;
            console.log(pts);
            setTimeoutWithLoading(function() {
            s7.style.display = "none";
            s8.style.display = "block";
            enableButtons();
        }, 2000);
        }
    }

    // sétima

    function h1() {
        disableButtons();
        if (p25.onclick) {
            console.log('Botão com id p25 foi clicado.');
            p25.style.backgroundColor = 'green';
            acerto.push(1);
            pts = pts + 5;
            console.log(pts);
            setTimeoutWithLoading(function() {
            s8.style.display = "none";
            s9.style.display = "block";
            enableButtons();
            a();
        }, 2000);
        } 
    }
    function h2() {
        disableButtons();
        if (p26.onclick) {
            console.log('Botão com id p26 foi clicado.');
            p26.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s8.style.display = "none";
            s9.style.display = "block";
            enableButtons();
            a();
        }, 2000);
        }
    }
    function h3() {
        disableButtons();
        if (p27.onclick) {
            console.log('Botão com id p27 foi clicado.');
            p27.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s8.style.display = "none";
            s9.style.display = "block";
            enableButtons();
            a();
        }, 2000);
        }
    }
    function h4() {
        disableButtons();
        if (p28.onclick) {
            console.log('Botão com id p28 foi clicado.');
            p28.style.backgroundColor = 'red';
            erro = erro + 1;
            setTimeoutWithLoading(function() {
            s8.style.display = "none";
            s9.style.display = "block";
            enableButtons();
            a();
            console.log(pts);
        }, 2000);
        }
    }

    function somarAcertos() {
    var total = 0;
    for (var index = 0; index < acerto.length; index++) {
        total += acerto[index];
    }
    return total;
    }

function a() {
    var total = somarAcertos();
    msg.innerHTML += `Sua pontuação foi de ${pts} pontos!`;
    console.log(pts);
    console.log(erro);
    console.log(acerto);

    var ID_USUARIO = sessionStorage.ID_USUARIO;
    fetch("/usuarios/quiz", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            idusuarioServer: ID_USUARIO,
            pontuacaoServer: pts,
            errosServer: erro,
            acertosServer: total, 
        }),
    })
    .then(function(resposta) {
        console.log("resposta:", resposta);
        if (resposta.ok) {
            rankgeral();
            puxarerroacerto()
        } else {
            throw "houve um erro ao responder";
        }
    })
    .catch(function(resposta) {
        console.log(`#erro: ${resposta}`);
    });
}


    function rankgeral() {
        var ID_USUARIO = sessionStorage.ID_USUARIO;
    fetch(`/usuarios/rankgeral?idusuario=${sessionStorage.getItem('ID_USUARIO')}`, {
  method: "GET",
  headers: {
    "Content-Type": "application/json",
  }
})
.then(function(resposta) {
    console.log("resposta:", resposta);
    if (!resposta.ok) {
        throw new Error("erro ao obter rank!");
    }  return resposta.json();
})
.then(function(data){
    console.log("ranking:", data);
    const nomes = data.map(item => item.nome); 
    const pontuacao = data.map(item => item.ultima_pontuacao);
    myChart2.data.labels = nomes;
    myChart2.data.datasets[0].data = pontuacao;
    myChart2.update();
})

.catch(function(resposta) {
    console.log(`#erro: ${resposta}`);
});
}

function puxarerroacerto() {
    var ID_USUARIO = sessionStorage.ID_USUARIO;
            fetch(`/usuarios/puxarerroacerto?idusuario=${ID_USUARIO}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                }
            })
            .then(function(resposta) {
                console.log("resposta:", resposta);
                if (!resposta.ok) {
                    throw new Error("erro ao obter erros e acertos!");
                }
                return resposta.json();
            })
            .then(function(data) {
                console.log("erros e acertos:", data);
                const erros = data.map(item => item.erros);
                const acertos = data.map(item => item.acertos);
                myChart.data.labels = ['Erros', 'Acertos'];
                myChart.data.datasets[0].data = [erros[0], acertos[0]];
                myChart.update();
            })
            .catch(function(erro) {
                console.log(`#erro: ${erro}`);
            });
        }

</script>
